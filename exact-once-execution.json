{
  "trigger": {
    "schedule": {
      "interval": "10m"
    }
  },
  "input": {
    "chain": {
      "inputs": [
        {
          "get_last_watch_execution_tracking_document": {
            "http": {
              "request": {
                "scheme": "http",
                "host": "localhost",
                "port": 9200,
                "method": "get",
                "path": "/.track_last_watch_execution/_doc/watch_idx1",
                "params": {},
                "headers": {}
              }
            }
          }
        },
        {
          "get_time_of_last_watch_execution": {
            "transform": {
              "script": {
                "source": "if ((ctx.payload.get_last_watch_execution_tracking_document).containsKey(\"ingest_timestamp\")) {return ctx.payload.get_last_watch_execution_tracking_document.ingest_timestamp} else {return \"1900-01-01T00:00:00+00:00\"}",
                "lang": "painless"
              }
            }
          }
        }
      ]
    }
  },
  "condition": {
    "always": {}
  },
  "actions": {
    "log": {
      "logging": {
        "level": "info",
        "text": "New Processes started! \n {{ctx.payload.get_time_of_last_watch_execution.ingest_timestamp}}"
      }
    }
  },
  "metadata": {
    "window_period": "10m"
  }
}


POST _scripts/update_trigger_time
{
  "script": {
    "lang": "painless",
    "source": """
      // If new, then initialize relevant fields.
      ctx._source['previous_trigger_time'] = ctx._source['trigger_time'];
      ctx._source['trigger_time'] = params.trigger_time;
    
    """
  }
}


POST watch_idx1/_update/watcher_tracker_doc?_source
{
  "scripted_upsert": true,
  "script": {
    "id": "update_trigger_time",
    "params": {
      "trigger_time": "2020-02-14T22:32:46Z"
    }
  },
  "upsert": {
    "trigger_time": "1900-01-01T00:00:00+00:00"
  }
}
    